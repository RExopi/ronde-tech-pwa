<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GESTION DES RONDES DES TECHNICIENS</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3b5998">
    <link rel="icon" type="image/png" href="icon-192x192.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
    <script src="app.js" defer></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
        }
        .header {
            background-color: #3b5998;
            color: #fff;
            text-align: center;
            padding: 20px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .header h1 {
            font-size: 2em;
            font-weight: bold;
            margin: 0;
        }
        .header p {
            font-size: 1em;
            margin: 5px 0 0;
        }
        .container {
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        h2 {
            color: #3b5998;
            text-align: center;
            margin-top: 0;
            font-size: 1.5em;
        }
        table {
            width: 100%;
            margin-bottom: 20px;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #3b5998;
            color: #fff;
            font-weight: bold;
        }
        td input[type="text"],
        td input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1em;
        }
        td input[type="text"]:focus,
        td input[type="number"]:focus,
        select:focus,
        textarea:focus {
            border-color: #3b5998;
            outline: none;
        }
        .panne {
            background-color: #e61414;
        }
        .ras {
            background-color: #ccffcc;
        }
        .button {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px;
            background-color: #3b5998;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }
        .button:hover {
            background-color: #2d4373;
        }
        .signature-pad {
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
            height: 250px;
        }
    </style>
</head>
<body>
    <!-- Page de connexion -->
    <div id="login-page" class="container">
        <h2>Connexion</h2>
        <form id="login-form">
            <label for="username">Nom d'utilisateur :</label>
            <input type="text" id="username" class="form-control" required>
            <label for="password">Mot de passe :</label>
            <input type="password" id="password" class="form-control" required>
            <button type="submit" class="button">Se connecter</button>
        </form>
    </div>

    <!-- Page principale (cachée par défaut) -->
    <div id="main-page" style="display: none;">
        <div class="header">
            <h1>GESTION DES RONDES DES TECHNICIENS</h1>
            <p><i class="fas fa-calendar-day"></i> Date et Heure : <span id="datetime">28/09/2024 07:36:03</span></p>
        </div>

        <div class="container">
            <!-- Quart de travail et responsable -->
            <h2>Détails de la Ronde</h2>
            <table>
                <tr>
                    <td>
                        <label for="quart"><i class="fas fa-clock icon"></i> Quart de travail :</label>
                        <select id="quart" name="quart">
                            <option value="matin">Matin</option>
                            <option value="soir">Soir</option>
                            <option value="nuit">Nuit</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="responsable"><i class="fas fa-user-tie icon"></i> Nom du responsable :</label>
                        <input type="text" id="responsable" placeholder="Nom du responsable">
                    </td>
                </tr>
            </table>

            <!-- Informations sur les techniciens -->
            <h2>Informations sur les Techniciens</h2>
            <table>
                <tr>
                    <th>Prénom et nom</th>
                    <th>Fonction</th>
                </tr>
                <tr>
                    <td><input type="text" placeholder="Prénom et nom"></td>
                    <td><input type="text" placeholder="Fonction"></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="Prénom et nom"></td>
                    <td><input type="text" placeholder="Fonction"></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="Prénom et nom"></td>
                    <td><input type="text" placeholder="Fonction"></td>
                </tr>
            </table>

            <!-- Fiche de contrôle / Inspections -->
            <h2>Fiche de Contrôle / Inspections</h2>
            <table>
                <tr>
                    <th>Tâches</th>
                    <th>État</th>
                </tr>
                <tr>
                    <td>Vérifier le niveau du bassin</td>
                    <td>
                        <input type="radio" name="niveau_bassin" value="RAS"> RAS
                        <input type="radio" name="niveau_bassin" value="BAS"> BAS
                    </td>
                </tr>
                <tr>
                    <td>Purger les condensats des compresseurs et le ballon</td>
                    <td>
                        <input type="radio" name="condensats_compresseurs" value="RAS"> RAS
                        <input type="radio" name="condensats_compresseurs" value="PANNE"> PANNE
                    </td>
                </tr>
                <tr>
                    <td>Vérifiez la pression d'eau entrée usine</td>
                    <td><input type="number" placeholder="Chiffres"></td>
                </tr>
                <tr>
                    <td>Vérifiez la pression d'air entrée usine</td>
                    <td><input type="number" placeholder="Chiffres"></td>
                </tr>
                <tr>
                    <td>Vérifiez la pression d'eau entrée extrudeuse</td>
                    <td><input type="number" placeholder="Chiffres"></td>
                </tr>
                <tr>
                    <td>Vérifiez les compresseurs si ça marche</td>
                    <td>
                        <input type="radio" name="compresseurs_fonctionnement" value="RAS"> RAS
                        <input type="radio" name="compresseurs_fonctionnement" value="PANNE"> PANNE
                    </td>
                </tr>
                <tr>
                    <td>Vérifiez les compresseurs froid</td>
                    <td><input type="number" placeholder="Chiffres"></td>
                </tr>
                <tr>
                    <td>Broyeur vérifier, contrôler et inspecter</td>
                    <td>
                        <input type="radio" name="broyeur_verification" value="RAS"> RAS
                        <input type="radio" name="broyeur_verification" value="PANNE"> PANNE
                    </td>
                </tr>
                <tr>
                    <td>Vérifier les coupes</td>
                    <td>
                        <input type="radio" name="verifier_coupes" value="RAS"> RAS
                        <input type="radio" name="verifier_coupes" value="PANNE"> PANNE
                    </td>
                </tr>
                <tr>
                    <td>Vérifiez niveau d'huile des tulipeuses</td>
                    <td>
                        <input type="radio" name="niveau_huile_tulipeuses" value="RAS"> RAS
                        <input type="radio" name="niveau_huile_tulipeuses" value="BAS"> BAS
                    </td>
                </tr>
                <tr>
                    <td>Vérifiez niveau d'huile des extrudeuses</td> 
                    <td>
                        <input type="radio" name="niveau_huile_extrudeuses" value="RAS"> RAS
                        <input type="radio" name="niveau_huile_extrudeuses" value="BAS"> BAS
                    </td>
                </tr>
            </table>

            <!-- Heures des machines -->
            <h3>Heures des Machines</h3>
            <table>
                <tr>
                    <th>Machines</th>
                    <th>Heures</th>
                </tr>
                <tr>
                    <td>Heure L400 PVC</td>
                    <td><input type="number" placeholder="Chiffres"></td>
                </tr>
                <tr>
                    <td>Heure L200 PVC</td>
                    <td><input type="number" placeholder="Chiffres"></td>
                </tr>
                <tr>
                    <td>Heure L400 PE</td>
                    <td><input type="number" placeholder="Chiffres"></td>
                </tr>
                <tr>
                    <td>Heure L63 PE</td>
                    <td><input type="number" placeholder="Chiffres"></td>
                </tr>
                <tr>
                    <td>Ligne annelé</td>
                    <td><input type="number" placeholder="Chiffres"></td>
                </tr>
                <tr>
                    <td>H compresseur 1</td>
                    <td><input type="number" placeholder="Chiffres"></td>
                </tr>
                <tr>
                    <td>H compresseur 2</td>
                    <td><input type="number" placeholder="Chiffres"></td>
                </tr>
            </table>

            <!-- Rapports supplémentaires -->
            <h2>Rapports Supplémentaires</h2>
            <textarea id="rapport-supplementaire" placeholder="Saisissez les détails supplémentaires ici..." rows="4"></textarea>

           
            <!-- Signature -->
            <h2>Signatures</h2>
            <canvas id="signature-pad" class="signature-pad"></canvas>
            <button class="button" id="clear-signature"><i class="fas fa-eraser"></i> Effacer la signature</button>
            <button class="button" onclick="savePage()"><i class="fas fa-save"></i> Sauvegarder</button>
            <button class="button" onclick="saveAsPDF()"><i class="fas fa-file-pdf"></i> Enregistrer en PDF</button>
            <button class="button" onclick="saveAsDOC()"><i class="fas fa-file-word"></i> Enregistrer en DOC</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const canvas = document.getElementById('signature-pad');
            const signaturePad = new SignaturePad(canvas);

            // Redimensionner le canvas pour une meilleure résolution
            function resizeCanvas() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                canvas.getContext("2d").scale(ratio, ratio);
            }

            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // Effacer la signature
            document.getElementById('clear-signature').addEventListener('click', function () {
                signaturePad.clear();
            });

            // Fonction pour sauvegarder la page
            function savePage() {
                const content = document.body.innerHTML;
                const blob = new Blob([content], { type: 'text/html' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'rapport_ronde.html';
                link.click();
            }

            window.savePage = savePage;

            // Fonction pour sauvegarder en PDF
            function saveAsPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.text(document.body.innerText, 10, 10);
                doc.save('rapport_ronde.pdf');
            }

            window.saveAsPDF = saveAsPDF;

            // Fonction pour sauvegarder en DOC
            function saveAsDOC() {
                const doc = new docx.Document();
                const paragraph = new docx.Paragraph(document.body.innerText);
                doc.addSection({ children: [paragraph] });
                docx.Packer.toBlob(doc).then(blob => {
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = 'rapport_ronde.docx';
                    link.click();
                });
            }

            window.saveAsDOC = saveAsDOC;

            // Fonction pour afficher l'heure dynamique
            function updateDateTime() {
                const now = new Date();
                const formattedDateTime = now.toLocaleString('fr-FR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                document.getElementById('datetime').textContent = formattedDateTime;
            }

            // Mettre à jour l'heure chaque seconde
            setInterval(updateDateTime, 1000);

            // Appeler la fonction immédiatement au chargement
            updateDateTime();

            // Enregistrer le Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(() => console.log('Service Worker enregistré'))
                    .catch((err) => console.error('Échec de l\'enregistrement du Service Worker', err));
            }

            // Fonction pour sauvegarder le rapport localement
            function saveReportLocally(report) {
                const reports = JSON.parse(localStorage.getItem('reports') || '[]');
                reports.push(report);
                localStorage.setItem('reports', JSON.stringify(reports));
            }

            // Gestion de la connexion
            const users = [
                { username: 'admin', password: 'admin123' },
                { username: 'technicien', password: 'tech123' }
            ];

            document.getElementById('login-form').addEventListener('submit', function (e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                const user = users.find(u => u.username === username && u.password === password);
                if (user) {
                    document.getElementById('login-page').style.display = 'none';
                    document.getElementById('main-page').style.display = 'block';
                } else {
                    alert('Nom d\'utilisateur ou mot de passe incorrect.');
                }
            });
        });
    </script>
</body>
</html>
